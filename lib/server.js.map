{"version":3,"sources":["../source/server.js"],"names":["global","Intl","require","IntlRelativeFormat","rf","articlesTemplate","fs","readFileSync","__dirname","encoding","ENV_PATH","dotenv","config","allowEmptyValues","path","process","env","MONGODB_PORT","MONGODB_HOST","MONGODB_NAME","DOMAIN","name","version","PORT","server","restify","createServer","formatters","req","res","body","JSON","stringify","pre","plugins","dedupeSlashes","sanitizePath","use","acceptParser","acceptable","queryParser","bodyParser","gzipResponse","cookieParser","parse","next","charSet","get","serveStatic","directory","query","s","undefined","trim","length","params","page","queryString","push","$match","state","Event","aggregate","result","map","event","article_id","setHeader","$and","$text","$search","$caseSensitive","$diacriticSensitive","_id","$in","$unwind","preserveNullAndEmptyArrays","$lookup","from","localField","foreignField","as","$group","url","$first","domain","title","published","lang","tags","contributors","author","translations","$push","$sort","parseInt","perPage","per_page","Article","full","total","pagesCount","Math","ceil","min","links","join","skip","max","limit","articles","article","publishedHuman","format","Date","isTranslation","data","filter","translation","translatedHuman","translated","translator","rendered","ejs","render","keywords","articlePaginationTemplate","articleFormTemplate","articleCardTemplate","Buffer","byteLength","status","send","end","mongoose","Promise","connect","useNewUrlParser","useCreateIndex","listen"],"mappings":"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","sourcesContent":["import restify from \"restify\";\nimport mongoose from \"mongoose\";\nimport cookieParser from \"restify-cookies\";\nimport dotenv from \"dotenv\";\nimport fs from \"fs\";\nimport { resolve } from \"path\";\nimport { Article, Event } from \"@frontender-magazine/models\";\nimport ejs from \"ejs\";\nimport queryString from \"query-string\";\n\nif (!global.Intl) {\n  global.Intl = require(\"intl\"); // eslint-disable-line\n}\nconst IntlRelativeFormat = require(\"intl-relativeformat\");\n\nconst rf = new IntlRelativeFormat(\"ru\");\n\nconst articlesTemplate = fs.readFileSync(\n  resolve(__dirname, \"../source/components/Articles/Articles.ejs\"),\n  {\n    encoding: \"utf-8\"\n  }\n);\n\nconst ENV_PATH = resolve(__dirname, \"../.env\");\ndotenv.config({\n  allowEmptyValues: false,\n  path: ENV_PATH\n});\nconst { MONGODB_PORT, MONGODB_HOST, MONGODB_NAME, DOMAIN } = process.env;\nconst { name, version } = require(\"../package.json\");\n\nconst PORT = process.env.PORT || 4000;\nconst server = restify.createServer({\n  name,\n  version,\n  formatters: {\n    \"application/json\": (req, res, body) => JSON.stringify(body),\n    \"text/html\": (req, res, body) => body\n  }\n});\n\nserver.pre(restify.plugins.pre.dedupeSlashes());\nserver.pre(restify.plugins.pre.sanitizePath());\nserver.use(restify.plugins.acceptParser(server.acceptable));\nserver.use(restify.plugins.queryParser());\nserver.use(restify.plugins.bodyParser());\nserver.use(restify.plugins.gzipResponse());\nserver.use(cookieParser.parse);\n\nserver.pre((req, res, next) => {\n  res.charSet(\"utf-8\");\n  return next();\n});\n\nserver.get(\n  {\n    path: /\\/(styles|images)\\/*/,\n    name: \"Serve styles\"\n  },\n  restify.plugins.serveStatic({\n    directory: `${__dirname}/../build/`\n  })\n);\n\n/**\n * Show articles list\n * @return {string} - html of the page\n */\nserver.get(\n  {\n    path: \"/\",\n    name: \"Show articles list\"\n  },\n  async (req, res, next) => {\n    if (req.query.s !== undefined && req.query.s.trim().length === 0) {\n      delete req.query.s;\n    }\n\n    let params = {\n      ...req.query\n    };\n    delete params.page;\n    params = queryString.stringify(params);\n\n    let query = [];\n\n    query.push({\n      $match: {\n        state: \"published\"\n      }\n    });\n\n    let result = await Event.aggregate(query);\n    result = result.map(event => event.article_id);\n\n    query = [];\n\n    if (req.query.s !== undefined) {\n      res.setHeader(\"Cache-Control\", \"no-cache\");\n      query.push({\n        $match: {\n          $and: [\n            {\n              $text: {\n                $search: req.query.s,\n                $caseSensitive: false,\n                $diacriticSensitive: false\n              }\n            },\n            {\n              _id: { $in: result }\n            }\n          ]\n        }\n      });\n    } else {\n      query.push({ $match: { _id: { $in: result } } });\n    }\n\n    query.push({\n      $unwind: {\n        path: \"$translations\",\n        preserveNullAndEmptyArrays: true\n      }\n    });\n\n    query.push({\n      $lookup: {\n        from: \"users\",\n        localField: \"author\",\n        foreignField: \"_id\",\n        as: \"author\"\n      }\n    });\n\n    query.push({\n      $lookup: {\n        from: \"users\",\n        localField: \"translations.author\",\n        foreignField: \"_id\",\n        as: \"translations.author\"\n      }\n    });\n\n    query.push({\n      $group: {\n        _id: \"$_id\",\n        url: { $first: \"$url\" },\n        domain: { $first: \"$domain\" },\n        title: { $first: \"$title\" },\n        published: { $first: \"$published\" },\n        lang: { $first: \"$lang\" },\n        tags: { $first: \"$tags\" },\n        contributors: { $first: \"$contributors\" },\n        author: { $first: \"$author\" },\n        translations: { $push: \"$translations\" }\n      }\n    });\n\n    query.push({\n      $sort: {\n        published: -1\n      }\n    });\n\n    let page = parseInt(req.query.page, 10) || 1;\n    const perPage = parseInt(req.query.per_page, 10) || 10;\n    const full = await Article.aggregate(query);\n    const total = full.length;\n    const pagesCount = Math.ceil(total / perPage);\n\n    page = Math.min(page, pagesCount);\n\n    const links = [];\n    links.push(`<${DOMAIN}?page=1>; rel=first`);\n    if (page > 1) {\n      links.push(`<${DOMAIN}?page=${page - 1}>; rel=prev`);\n    }\n    links.push(`<${DOMAIN}?page=${page}>; rel=self`);\n    if (page < pagesCount) {\n      links.push(`<${DOMAIN}?page=${page + 1}>; rel=prev`);\n    }\n    links.push(`<${DOMAIN}?page=${pagesCount}>; rel=last`);\n    res.setHeader(\"Link\", links.join(\", \"));\n\n    let articles = await Article.aggregate(query)\n      .skip(Math.max(page - 1, 0) * perPage)\n      .limit(perPage);\n    articles = articles.map(article => {\n      const publishedHuman = rf.format(new Date(article.published));\n      const isTranslation = article.domain !== \"frontender.info\";\n      let data = {\n        isTranslation,\n        url: article.url,\n        title: article.title,\n        published: article.published,\n        publishedHuman,\n        author: article.author\n      };\n\n      if (isTranslation) {\n        const translations = article.translations.filter(\n          translation => translation.domain === \"frontender.info\"\n        );\n        const translation = translations.length > 0 ? translations[0] : null;\n        const translatedHuman = rf.format(new Date(translation.published));\n\n        data = {\n          ...data,\n          isTranslation,\n          url: translation.url,\n          title: translation.title,\n          translated: translation.published,\n          translatedHuman,\n          translator: translation !== null ? translation.author : []\n        };\n      }\n\n      return data;\n    });\n\n    const rendered = ejs.render(articlesTemplate, {\n      params,\n      keywords: req.query.s !== undefined ? req.query.s : \"\",\n      articles,\n      pagesCount,\n      page,\n      articlePaginationTemplate: resolve(\n        __dirname,\n        \"../source/components/Pagination/Pagination.ejs\"\n      ),\n      articleFormTemplate: resolve(\n        __dirname,\n        \"../source/components/SearchForm/SearchForm.ejs\"\n      ),\n      articleCardTemplate: resolve(\n        __dirname,\n        \"../source/components/ArticleCard/ArticleCard.ejs\"\n      )\n    });\n\n    res.setHeader(\"Content-Type\", \"text/html; charset=utf-8\");\n    res.setHeader(\"Content-Length\", Buffer.byteLength(rendered));\n    res.setHeader(\"X-Pagination-Current-Page\", page);\n    res.setHeader(\"X-Pagination-Per-Page\", perPage);\n    res.setHeader(\"X-Pagination-Total-Count\", total);\n    res.setHeader(\"X-Pagination-Page-Count\", pagesCount);\n\n    res.status(200);\n    res.send(rendered);\n    res.end();\n    return next();\n  }\n);\n\n(async () => {\n  mongoose.Promise = global.Promise;\n  await mongoose.connect(\n    `mongodb://${MONGODB_HOST}:${MONGODB_PORT}/${MONGODB_NAME}`,\n    {\n      useNewUrlParser: true,\n      useCreateIndex: true\n    }\n  );\n  server.listen(PORT);\n})();\n"],"file":"server.js"}